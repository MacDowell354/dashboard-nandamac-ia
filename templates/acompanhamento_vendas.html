{% extends "base.html" %}
{% block title %}Acompanhamento de Vendas — Dashboard IA{% endblock %}
{% block head_extra %}<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>{% endblock %}
{% block content %}
  <h2>Acompanhamento de Vendas</h2>
  {% if not has_data %}
    <div class="card"><p>Sem dados de vendas.</p></div>
  {% else %}
    <div class="kpis" style="margin: 8px 0 18px;">
      <div class="kpi"><h3>Total de vendas</h3><strong>{{ kpis.qtd }}</strong></div>
      <div class="kpi"><h3>Valor líquido (soma)</h3><strong>{{ kpis.liquido|br_money }}</strong></div>
    </div>

    <div class="card" style="margin-bottom:16px;">
      <h3 style="margin-top:0">Vendas por dia (valor líquido)</h3>
      <canvas id="salesChart"></canvas>
    </div>

    <div class="card">
      <h3 style="margin-top:0">Amostra de registros</h3>
      <div style="overflow-x:auto;">
        <table>
          <thead>
            {% if table and table[0] %}
              <tr>{% for k in table[0].keys() %}<th>{{ k }}</th>{% endfor %}</tr>
            {% endif %}
          </thead>
          <tbody>
            {% for row in table %}
              <tr>{% for v in row.values() %}<td>{{ v|dash }}</td>{% endfor %}</tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  {% endif %}
{% endblock %}
{% block body_extra %}
{% if has_data %}
<script>
const series = {{ series|tojson }};
new Chart(document.getElementById('salesChart').getContext('2d'), {
  type: 'line',
  data: { labels: series.map(p=>p.x), datasets: [{ label: 'Líquido por dia', data: series.map(p=>p.y), tension: .25 }] },
  options: { responsive: true, scales: { x: { ticks: { autoSkip: true, maxTicksLimit: 10 } } } }
});
</script>
{% endif %}
{% endblock %}
