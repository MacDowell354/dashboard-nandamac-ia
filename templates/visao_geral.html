{% extends "base.html" %}
{% block title %}Vis√£o Geral ‚Äî Dashboard IA{% endblock %}

{% block content %}
<h2>Vis√£o Geral ‚Äî CHT22</h2>
<p class="muted" style="margin-top:-6px">Resumo executivo do lan√ßamento com m√©tricas principais e status.</p>

<!-- ===== Cards do topo (Resumo Executivo) ===== -->
<div class="kpis" style="margin:12px 0 18px;">
  <div class="kpi">
    <h3>Lan√ßamento Ativo</h3>
    <strong>{{ topo.dias or "‚Äî" }} DIAS</strong>
    <div class="muted">Em andamento</div>
  </div>

  <div class="kpi">
    <h3>Meta CPL Capta√ß√£o</h3>
    <strong>
      {% if topo.delta_cpl is not none %}
        {{ topo.delta_cpl|round(1) }}%
      {% else %}‚Äî{% endif %}
    </strong>
    <div class="muted">{{ br_money(topo.cpl_atual) }} vs {{ br_money(topo.meta_cpl) }}</div>
  </div>

  <div class="kpi">
    <h3>Or√ßamento Capta√ß√£o</h3>
    <strong>
      {% if topo.delta_orc is not none %}
        {{ topo.delta_orc|round(1) }}%
      {% else %}‚Äî{% endif %}
    </strong>
    <div class="muted">{{ br_money(topo.inv_usado) }} / {{ br_money(topo.orc_meta) }}</div>
  </div>

  <div class="kpi">
    <h3>ROAS Geral</h3>
    <strong>{{ topo.roas|dash }}</strong>
    <div class="muted">
      {% if topo.roas and topo.roas >= 2 %}Acima da meta{% else %}Abaixo/sem meta{% endif %}
    </div>
  </div>
</div>

<!-- ===== Principais Insights por canal ===== -->
<h3 style="margin:16px 0 8px;">Principais Insights</h3>
<div style="display:grid; grid-template-columns: repeat(3, minmax(0,1fr)); gap:12px;">
  {% if canais_cards and canais_cards|length > 0 %}
    {% for c in canais_cards %}
      <div class="card" style="border-left:6px solid {% if c.tone=='positivo' %}#2ecc71{% elif c.tone=='alerta' %}#ff9800{% else %}#6e8efb{% endif %};">
        <div style="font-weight:600; margin-bottom:6px">{{ c.title }}</div>
        <div class="muted">{{ c.body }}</div>
      </div>
    {% endfor %}
  {% else %}
    <div class="card"><div class="muted">Sem dados suficientes por canal.</div></div>
    <div class="card" style="opacity:.6"><div class="muted">Preencha no bloco CAMPO as m√©tricas por canal (ex.: Facebook_Leads, Facebook_CPL, Facebook_ROAS...).</div></div>
    <div class="card" style="opacity:.6"><div class="muted">Assim que houver dados, os insights aparecem aqui automaticamente.</div></div>
  {% endif %}
</div>

<!-- ===== KPIs & Premissas ===== -->
<h3 style="margin:18px 0 8px;">KPIs & Premissas</h3>
<div class="kpis">
  {% for k in kpis_cards %}
    <div class="kpi">
      <h3>{{ k.titulo }}</h3>
      {% if k.tipo == 'money' %}
        <strong>{{ k.valor|br_money }}</strong>
      {% elif k.tipo == 'percent' %}
        <strong>{{ (k.valor|round(2)) if k.valor is not none else '‚Äî' }}%</strong>
      {% else %}
        <strong>{{ k.valor|dash }}</strong>
      {% endif %}
      <div class="muted">{{ k.subtitulo }}</div>
    </div>
  {% endfor %}
</div>

<!-- ===== Metas & Sem√°foros (opcional) ===== -->
{% if metas and metas|length > 0 %}
  <div class="card" style="margin-top:16px;">
    <h3 style="margin:0 0 8px;">Metas & Sem√°foros</h3>
    <div style="overflow-x:auto;">
      <table>
        <thead>
          <tr>
            <th>M√©trica</th>
            <th>Atual</th>
            <th>Meta</th>
            <th>Atingimento</th>
            <th>Status</th>
          </tr>
        </thead>
        <tbody>
          {% for m in metas %}
            <tr>
              <td>{{ m.nome }}</td>
              <td>
                {% if m.nome in ['CPL M√©dio','Execu√ß√£o do Or√ßamento'] %}
                  {{ m.atual|br_money }}
                {% else %}
                  {{ m.atual|dash }}
                {% endif %}
              </td>
              <td>
                {% if m.nome in ['CPL M√©dio','Execu√ß√£o do Or√ßamento'] %}
                  {{ m.meta|br_money }}
                {% else %}
                  {{ m.meta|dash }}
                {% endif %}
              </td>
              <td>{{ m.atingimento|round(1) }}%</td>
              <td>
                {% if m.status == 'verde' %}üü¢{% elif m.status == 'amarelo' %}üü°{% else %}üî¥{% endif %}
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
    <p class="muted" style="margin-top:8px">
      Regras: CPL (menor melhor), Vendas (maior melhor), Or√ßamento (evitar extrapolar o planejado).
    </p>
  </div>
{% endif %}

<!-- ===== Rodap√©/observa√ß√µes ===== -->
<div class="card" style="margin-top:16px">
  <div class="muted">
    Observa√ß√£o: esta aba √© alimentada pelo bloco <em>CAMPO | VALOR ATUAL</em> da planilha.
    Se algum item ficar ‚Äú‚Äî‚Äù, basta preencher a m√©trica correspondente no Google Sheets (ex.: <code>Meta_CPL</code>, <code>Meta_Orcamento_Trafego</code>, <code>Facebook_ROAS</code> etc.).
  </div>
</div>
{% endblock %}
